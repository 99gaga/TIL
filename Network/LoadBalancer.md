# 로드밸런서

### 왜 필요할까?

평소 유튜브나 배달의 민족과 같은 서비스를 이용하다 보면 폭발적으로 트래픽이 몰리는 경우가 있다. 아무리 성능이 뛰어난 서버라고 해도 한계가 생기기 마련이다. 그래서 트래픽을 감당하기 위해 보통 `scale up` 또는 `scale out`으로 해결한다.

- `scale up` <br>
  하드웨어적인 성능을 높이는 것으로 서버 자체의 성능을 높인다.<br>
  일반적으로 쉬운 설계방식이다 하지만, 확장에 결국 제한이 생기고, 서버 한대를 사용하므로 장애 발생시 치명적이다.<br>

- `scale out` <br>
  서버를 여러대 추가해 시스템을 확장한다. <br>
  서버 한대가 장애가 나더라도 다른 서버로 대체할 수 있고 확장성이 더욱 커진다. <br>
  하지만 서버간의 세션 정보등 데이터의 불일치가 발생한다. 하지만 `로드 밸런서`를 사용하여 해결할 수 있다.<br>

### Load Banlancing이란?

로드밸런서는 `scale out`으로 확장 했을 때 애플리케이션의 트래픽을 분산시켜주는 역할을 한다.<br>

### Load Balancing이 사용하는 알고리즘

- Round Robin
  클라이언트의 요청을 순서대로 돌아가며 서버에 배정한다. 클라이언트의 요청을 순서대로 분배하기 때문에 여러 대의 서버가 동일한 스펙이고 서버와의 연결이 오래 지속되지 않는 경우 활용하기 적합하다. 하지만 순서대로 배분하다가 보면 어느 특정 서버에 트래픽이 몰릴 수도 있다.
  <br>

- Weight Round Robin
  서버의 트래픽 처리능력이 다를 경우 성능이 높은 서버에 가중치를 높게주어 더 많은 트래픽을 분배할 수 있다.
  <br>

- IP Hash
  클라이언트의 IP 주소를 특정 서버로 매핑하여 요청을 처리하는 방식이다. 사용자의 IP를 해싱해서 사용자가 항상 동일한 서버로 연결되는 것을 보장한다.
  <br>

- Least Connection
  요청이 들어온 시점에 가장 적은 연결상태를 가지고 있는 서버에 우선적으로 트래픽을 분배한다. 서버에 분배된 트래픽이 일정하지 않은 경우에 적합하다.
  <br>

- Least Response
  서버의 현재 연결상태와 응답시간을 고려하여 트래픽을 배분한다. 즉, 가장 적은 연결상태를 가지고 있고 응답시간이 제일 짧은 서버에 우선적으로 배분한다.
  <br>

### L4 Load Balancer & L7 Load Balancer

L4로드밸런서는 IP,TCP,UDP,Port 정보를 바탕으로 트래픽을 분산한다. 데이터 안을 들여다 보지 않고 패킷 레벨에서만 로드를 분산하기 때문에 L7에 비해서 빠르고 효율이 높다. 하지만 패킷의 내용을 살펴보지 않기 때문에 L7보다 섬세한 라우팅이 불가능하다. 그리고 사용자의 IP가 수시로 바뀐다면 연속적인 서비스를 제공하기 어렵다.<br>
<br>
L7은 URI 또는 쿠키 정보등을 바탕으로 트래픽을 분산한다. L4 보다 좀더 섬세한 라우팅이 가능하며 캐싱 기능을 제공한다. 도한 패킷의 내용을 복호화해야하기 때문에 더 높은 비용을 지불해야하며 로드밸런서가 클라이언트와 인증서를 공유해야하기 때문에 공격받아서 클라이언트 데이터에 접근할 가능성이 있다.<br>
<br>
